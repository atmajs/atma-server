UTest({
	$config: {
		'http.include': [
			'test/service-dom/service-reject.js'
		]
	},
	
	'string error': function(done){
		UTest
			.server
			.request('/reject/string')
			.done(assert.avoid())
			.fail(toJSOND(function(error){


				eq_(error.error, 'String reject');
				deepEq_(Object.keys(error), ['error', 'code']);
				done();
			}))
	},
	'native error': function(done){
		UTest
			.server
			.request('/reject/native')
			.done(assert.avoid())
			.fail(toJSOND(function(error){


				eq_(error.code, 500);
				eq_(error.error, 'TypeError: Native reject');
				

				deepEq_(Object.keys(error), ['error', 'code']);
				done();
			}))
	},
	'http error': function(done){
		UTest
			.server
			.request('/reject/http')
			.done(assert.avoid())
			.fail(toJSOND(function(error, code){

				eq_(error.code, 500);	
				eq_(error.error, 'HttpError: Http reject');
				deepEq_(Object.keys(error), ['error', 'code']);
				done();
			}))
	},
	'object error': function(done){
		UTest
			.server
			.request('/reject/object')
			.done(assert.avoid())
			.fail(toJSOND(function(error, code){
				
				deepEq_(error, {
					error: 'FooError',
					baz: 'Lorem'
				});	
				done();
			}))
	}
})

function toJSON(xhr){
	try {
		return JSON.parse(xhr.responseText);
	} catch(error) {
		console.error('>parse error', error);

		return {};
	}
}

function toJSOND(fn){
	
	return function(xhr){
		debugger
		console.log(xhr.status, xhr.statusCode.status);
		return fn(toJSON(xhr), xhr.statusCode);
	}
}